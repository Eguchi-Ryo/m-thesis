# シミュレーションについて
## コンパイルの方法
前提として、コンパイルには`Makefile`が使われるため、各の環境にあったコンパイルオプションに変更する必要がある
- **re_initialize.sh**
一度オブジェクトファイルを全て消去した後、コンパイルする。ヘッダファイルを変更した時やはじめからやり直したい時に使用する。
- **re_compile.sh**
再度コンパイルを実施する。ヘッダファイルを変えていない場合はこちらで十分。**re_initialize.sh**よりも速い。

## シミュレーションのオプションについて
ここにあげたものは大丈夫ですが、mpmのコードにあるのみのオプションは、一部使用しても意味のないオプションがあるので、注意してください
- outlog : 出力するログファイルへのパス
- iipath : imageファイルが入っているディレクトリへのパス
- iiname : imageファイルの名前。数十枚あるはずなので、%dを用いた名前にする
- ilpath : 各臓器のlabelディレクトリが入っているディレクトリへのパス
- ilname : labelファイルの名前。数十枚あるはずなので、%dを用いた名前にする
- output : 画像を出力するかどうかのフラグ。0なら出さず、1なら出す
- outimg : シミュレーション実行結果の画像ファイル出力先
- outscl : outimgを2値画像にしたもの
- outcsv : シミュレーション実行結果の、各画素の位置がまとまったcsvファイルへのパス。このcsvを使って**error**を計算する
- tar : シミュレーションに使用する臓器の組み合わせ
    - 1 : 膵臓
    - 2 : 胃
    - 3 : 十二指腸
    - 4 : 左の腎臓  
    となっており、1234,124などのような形で入力する
- mode : シミュレーションの実行モード
    - 1 : 正解データ作成の際に使用される、全ての粒子の目標位置を用いて実行するモード
    - 2 : **axial**の時に使用される、アフィンパラメータから正解位置を計算するモード
    - 3 : elastixによる3D/3D画像位置合わせの結果を使用するモード
    - 4 : **multi**の時に使用する、駆動断層を正解位置により動かすモード

- tarcsv : mode=1,4の時に使用する、正解位置が入ったcsvファイルへのパス
- trans : mode=2の時に使用する、アフィンパラメータが入ったファイルへのパス
- 3Dtrans : mode=3の時に使用する、3D/3D位置合わせの結果が入ったファイルへのパス
- outElximg : elastixによる結果の画像の出力先
- out3Dcsv : mode=3の時に使用する、3D/3D画像位置合わせにより変形させた場合の各画素の位置情報が入ったcsvファイルの出力先
- aipath : mode=2,3,4の時に使用する、dice係数を計算するために使用する正解データの画像が入ったディレクトリへのパス
- ainame : imageファイルの名前。数十枚あるはずなので、%dを用いた名前にする
- dfile : mode=2,3,4の時に使用する、diceスコアを書き加えていくためのファイルへのパス
- info : 画像サイズやスペーシングなどが入ったファイルへのパス
- initcsv : 初期状態のerrorまたはdiceを求める際に使用する、初期状態の各画素の位置情報が入ったcsvファイルへのパス
- cs : mode=2の時に使用する、駆動させる断層の位置
- cs_x : mode=4の時に使用する、駆動させるx軸方向の断層の位置
- cs_y : mode=4の時に使用する、駆動させるy軸方向の断層の位置
- cs_z : mode=4の時に使用する、駆動させるz軸方向の断層の位置
- unconverged : mode=2,4の時に使用する、一定回数（現状2000回）反復しても結果が収束しなかった場合にその条件を記述するファイルへのパス
- divergence : mode=2,4の時に使用する、シミュレーションが発散した時にその条件を記述するファイル


