# シミュレーション実行

## 一つの断面のデータを用いて実行する場合(axial)
exec_list.csvに  
- **arrange**ディレクトリのコードによって作成したディレクトリへの絶対パス
    - 最後に"/"を忘れずにつける
- シミュレーション実行の種類
    - all (膵臓、胃、十二指腸、腎臓全てを使用した場合)
    - panc
    - panc-stom
    - panc-duo
    - panc-lkid
    - panc-stom-duo
    - panc-stom-lkid
    - panc-duo-lkid
    のどれか一つを書く
- 駆動させる断層の位置  

を1行にして作る。サンプルは**axial/exec_list_sample.csv**  
その後、**exec_per_simulation.sh**を実行する  
`./exec_per_simulation.sh`

## 複数の断面のデータを用いて実行する場合(multi)
### 追加処理
**arrange**により作成したあとに追加で処理を必要とする。
**arrange**により作成したディレクトリ構造のうち、**simulation**ディレクトリの中に、実行したい条件のディレクトリを作成する。  
命名規則は(x軸方向の断層位置)\_(y軸方向の断層位置)\_(z軸方向の断層位置)とする。ex) 150_126_34
### 実行方法
exec_list.csvに
- **arrange**ディレクトリのコードによって作成したディレクトリへの絶対パス
    - 最後に"/"を忘れずにつける
- x軸方向(coronal)の駆動断層の位置
- y軸方向(sagittal)の駆動断層の位置
- z軸方向(axial)の駆動断層の位置
    - **axial**の時に指定する断層位置-1とすることに注意(z座標の値と断層位置はシミュレーションの入力関係から1違う)

を1行にして作る。サンプルは**multi/exec_list_sample.csv**  
その後、**exec_per_simulation.sh**を実行する  
`./exec_per_simulation.sh`

## 推定結果一覧
- ユーグリッド誤差(error)の計算方法:  
使用するもの
    - **simulation/data/data\*\*\*.csv**と名のついたファイル  
    推定結果の全ての画素の位置情報が入っています。
    - **making_data/answer_data.csv**  
    正解データの全ての画素の位置情報が入っています。

    このファイルは
    - 画素の通し番号(両ファイルで共通)
    - x座標
    - y座標
    - z座標
    - 断層番号
    - dcm値
    - 臓器の種類
        - 1 : 膵臓
        - 2 : 胃
        - 3 : 十二指腸
        - 4 : 左の腎臓  

    で構成されています。x~z座標の位置のデータを使用して、errorを計算することができます。  
    **elastix_data.csv**には、3D/3D画像位置合わせによる結果が入っており、**elastix_error.csv**はその結果を用いて計算されたerrorが入っている。  
    **init_error.csv**は初期状態と正解データを比較した際のerrorが入っている

- dice係数
**simulation/data/dice_score.csv**に全てのデータが入っている
    - axialを実行した時  
        - 駆動させた断層の位置
        - 使用した臓器の種類
            - 1 : 膵臓
            - 2 : 胃
            - 3 : 十二指腸
            - 4 : 左の腎臓
        - 結果
            - **init**で始まるもの : 初期状態と正解データを比較した時の結果
            - **elastix**で始まるもの : 3D/3D位置合わせによる結果
            - **sim**で始まるもの : シミュレーションにより推定されたもの
            - その後に続く名前は、それぞれの臓器に関しての値。**all**は、すべての臓器同士を比較した場合であり、シミュレーションの際に**all**を選択した場合のみ意味をなしている。
        - dice係数の値
    - multiを実行した時
        - x軸方向の駆動断層位置
        - y軸方向の駆動断面位置
        - z軸方向の駆動断層位置
            - **axial**の時に指定する断層位置-1とすることに注意(z座標の値と断層位置はシミュレーションの入力関係から1違う)
        - dice係数の値

